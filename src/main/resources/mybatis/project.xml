<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project">

	<select id="select" resultType="java.util.LinkedHashMap" fetchSize="500">
		select prime.organization,
			   prime.organization_name,
		       prime.code_value as project_identifier,
		       prime.project_name,
		       prime.description,
		       prime.sampling_design_type_code,
		       prime.qapp_approved_indicator,
		       prime.qapp_approved_agency_name,
		       prime.project_file_url,
		       prime.monitoring_location_weight_url
       <include refid="dynamicWhere.projectsBase"/>
	       order by prime.data_source_id,
	       			prime.organization,
	       			prime.code_value,
	       			prime.project_id
	</select>
	
	<sql id="projectCount">
		select
			data_source, 
			count(distinct data_source|| '-' ||prime.code_value) as project_count
		from project_dim prime
		<choose>
			<when test="analyticalmethod == null and assemblage == null and characteristicName == null and
						characteristicType == null and pCode == null and subjectTaxonomicName == null">
				<include refid="dynamicWhere.projectJoinActivitySum" />		
			</when>
			<otherwise>
				<include refid="dynamicWhere.projectJoinResultSum"/>
			</otherwise>
		</choose>
		group by rollup(data_source)
	</sql>
	
	<select id="count" resultType="java.util.LinkedHashMap">
		<include refid="project.projectCount"/>
	</select>
	
</mapper>